---
// Navigation.astro - Responsive navigation matching your theme
export interface Props {
  currentPage?: string;
}

const { currentPage = '' } = Astro.props;

const navItems = [
  { href: '/', label: 'Home', icon: 'fa-home' },
  { href: '/flash', label: 'Flash Firmware', icon: 'fa-microchip' },
  { href: '/docs', label: 'Documentation', icon: 'fa-book' },
  { href: '/community', label: 'Community', icon: 'fa-users' },
  { href: 'https://github.com/031devstudios/weighmybru2', label: 'GitHub', icon: 'fa-github', external: true }
];
---

<div class="md:flex flex-col md:flex-row md:min-h-screen w-full font-light">
  <!-- Mobile Navigation -->
  <div x-data="{ open: false }" @click.away="open = false" class="md:hidden fixed top-0 left-0 right-0 z-50 bg-black-discord">
    <div class="flex justify-between items-center px-4 py-3">
      <a href="/" class="text-lg font-semibold tracking-widest text-green-600 uppercase">WeighMyBru²</a>
      <button class="focus:outline-none" @click="open = !open">
        <svg fill="currentColor" viewBox="0 0 20 20" class="w-6 h-6 text-white">
          <path x-show="!open" fill-rule="evenodd" d="M3 5a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 10a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM9 15a1 1 0 011-1h6a1 1 0 110 2h-6a1 1 0 01-1-1z" clip-rule="evenodd"></path>
          <path x-show="open" fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
        </svg>
      </button>
    </div>
    
    <nav x-show="open" x-transition class="bg-black-discord px-4 pb-4">
      {navItems.map(item => (
        <a 
          href={item.href}
          target={item.external ? "_blank" : undefined}
          rel={item.external ? "noopener noreferrer" : undefined}
          class={`block px-4 py-2 mt-2 text-sm font-semibold rounded-lg transition-colors ${
            currentPage === item.href 
              ? 'text-stone-50 bg-black-select' 
              : 'text-gray-400 bg-transparent hover:text-stone-50 hover:bg-black-hover'
          }`}
        >
          <i class={`fa ${item.icon} mr-2`} style="color: rgb(25, 124, 40);"></i>
          {item.label}
          {item.external && <i class="fa fa-external-link-alt ml-1 text-xs"></i>}
        </a>
      ))}
    </nav>
  </div>

  <!-- Desktop Navigation -->
  <div class="hidden md:flex md:flex-col md:w-64 md:fixed md:left-0 md:top-0 md:h-full bg-black-discord">
    <div class="px-8 py-4">
      <a href="/" class="text-lg font-semibold tracking-widest text-green-600 uppercase">WeighMyBru²</a>
    </div>
    <nav class="flex-grow px-4 pb-4">
      {navItems.map(item => (
        <a 
          href={item.href}
          target={item.external ? "_blank" : undefined}
          rel={item.external ? "noopener noreferrer" : undefined}
          class={`block px-4 py-2 mt-2 text-sm font-semibold rounded-lg transition-colors ${
            currentPage === item.href 
              ? 'text-stone-50 bg-black-select' 
              : 'text-gray-400 bg-transparent hover:text-stone-50 hover:bg-black-hover'
          }`}
        >
          <i class={`fa ${item.icon} mr-2`} style="color: rgb(25, 124, 40);"></i>
          {item.label}
          {item.external && <i class="fa fa-external-link-alt ml-1 text-xs"></i>}
        </a>
      ))}
    </nav>
    
    <!-- Version info in sidebar -->
    <div class="px-4 py-4 border-t border-gray-700">
      <div class="text-xs text-gray-500">
        <div>Latest Release</div>
        <div id="sidebar-version" class="text-green-600 font-semibold">Loading...</div>
      </div>
    </div>
  </div>

  <!-- Main content area -->
  <main class="flex-grow md:ml-64 min-h-screen">
    <slot />
  </main>
</div>

<script>
  // Update version info in sidebar
  async function updateSidebarVersion() {
    try {
      const response = await fetch('https://api.github.com/repos/031devstudios/weighmybru2/releases/latest');
      const release = await response.json();
      const versionEl = document.getElementById('sidebar-version');
      if (versionEl && release.tag_name) {
        versionEl.textContent = release.tag_name;
      }
    } catch (error) {
      console.error('Failed to fetch version:', error);
    }
  }
  
  updateSidebarVersion();
</script>